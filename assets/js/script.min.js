function initPlugin(){window.cm=window.CodeMirror.fromTextArea(window.editor,{mode:{name:"markdown",highlightFormatting:!0},theme:"markdown",autofocus:!0,lineNumbers:!0,indentUnit:4,tabSize:2,electricChars:!0,styleActiveLine:!0,matchBrackets:!0,lineWrapping:!0,dragDrop:!1,extraKeys:{Enter:"newlineAndIndentContinueMarkdownList"}}),cm.on("change",function(e){var t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!1),window.editor.dispatchEvent(t),window.editor.value=cm.getValue()}),window.marked.setOptions({langPrefix:"language-",breaks:!0})}function getMarkedValue(e){return e=stripScriptTag(e),marked(e)}function setPreview(){var e=getMarkedValue(window.editor.value);setTextCount(e),window.result.innerHTML=e,Prism.highlightAll()}function stripScriptTag(e){for(var t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi;t.test(e);)e=e.replace(t,"");return e}function setTextCount(e){var t=document.getElementById("chara-count");t.innerHTML=e.length}function togglePreview(e){var t=document.getElementsByClassName("preview-side")[0],n=document.getElementsByClassName("editor-side")[0],i=e.classList;"none"==t.style.display?(t.style.display="",n.style.width="",i.remove("octicon-chevron-left"),i.add("octicon-chevron-right")):(t.style.display="none",n.style.width="100%",i.remove("octicon-chevron-right"),i.add("octicon-chevron-left"))}function save(){window.confirm("Save?")&&(saveStorage(window.editor.value),setPreview())}function clear(){window.confirm("Clear?")&&(cm.getDoc().setValue(""),window.editor.value="",clearStorage(),setPreview())}function saveStorage(e){localStorage.setItem(STORAGE_KEYNAME,e)}function loadStorage(e){e.innerHTML=localStorage.getItem(STORAGE_KEYNAME)}function clearStorage(){localStorage.removeItem(STORAGE_KEYNAME)}var STORAGE_KEYNAME="MiiKun";window.onload=function(){"use strict";window.editor=document.getElementById("editor"),window.result=document.getElementById("result");var e=document.getElementById("modal"),t=document.getElementById("export"),n=(document.getElementById("chara-count"),document.getElementsByClassName("btn-preview")[0]),i=document.getElementsByClassName("btn-toggle")[0];initPlugin(),editor.addEventListener("change",function(){setPreview()},!1),editor.value&&setPreview(),n.addEventListener("click",function(){t.value=getMarkedValue(editor.value),e.style.display="block"},!1),t.addEventListener("focus",function(){t.select()},!1),i.addEventListener("click",function(e){togglePreview(e.target)},!1),window.addEventListener("click",function(t){t.target==e&&(e.style.display="none")},!1)};